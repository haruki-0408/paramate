# APS (AWS Parameter Sync)

CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰AWS Parameter Storeã¨AWS Secrets Managerã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åŒæœŸã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

## æ©Ÿèƒ½

- **CSVè§£æ**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ä»˜ãã®CSVãƒ•ã‚¡ã‚¤ãƒ«è§£æ
- **AWS Parameter Store**: Stringã¾ãŸã¯SecureStringã‚¿ã‚¤ãƒ—ã§ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒæœŸ
- **AWS Secrets Manager**: JSONã¾ãŸã¯ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆåŒæœŸ
- **ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³**: å®Ÿéš›ã«å¤‰æ›´ã‚’é©ç”¨ã›ãšã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
- **è©³ç´°ãƒ­ã‚°**: æˆåŠŸã€å¤±æ•—ã€æ›´æ–°ã€ã‚¹ã‚­ãƒƒãƒ—ã‚’è‰²åˆ†ã‘ã—ãŸç¾ã—ã„ãƒ­ã‚°å‡ºåŠ›
- **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ**: é–‹å§‹æ™‚ã«ä½¿ç”¨ã§ãã‚‹CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç”Ÿæˆ
- **AWSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ**: ç•°ãªã‚‹AWSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ä½¿ç”¨

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install -g aws-parameter-sync-cli
```

ã¾ãŸã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ãƒ“ãƒ«ãƒ‰:

```bash
git clone <repository-url>
cd aws-parameter-sync
npm install
npm run build
npm link
```

## ä½¿ç”¨æ–¹æ³•

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ

CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦é–‹å§‹:

```bash
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ä¸¡æ–¹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”Ÿæˆ
aps generate-template

# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã¿ç”Ÿæˆ
aps generate-template --type parameters

# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã¿ç”Ÿæˆ
aps generate-template --type secrets

# å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š
aps generate-template --output ./my-templates
```

### Parameter Storeã¸ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒæœŸ

```bash
# åŸºæœ¬çš„ãªåŒæœŸ
aps sync-parameters --file parameters.csv

# ç‰¹å®šã®AWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
aps sync-parameters --file parameters.csv --region us-west-2 --profile production

# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼ˆå¤‰æ›´ã‚’é©ç”¨ã›ãšã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
aps sync-parameters --file parameters.csv --dry-run
```

### Secrets Managerã¸ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆåŒæœŸ

```bash
# åŸºæœ¬çš„ãªåŒæœŸ
aps sync-secrets --file secrets.csv

# ç‰¹å®šã®AWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
aps sync-secrets --file secrets.csv --region us-west-2 --profile production

# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼ˆå¤‰æ›´ã‚’é©ç”¨ã›ãšã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
aps sync-secrets --file secrets.csv --dry-run
```

## CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿CSV

| åˆ—å | å¿…é ˆ | èª¬æ˜ | æœ‰åŠ¹ãªå€¤ |
|------|------|------|----------|
| name | ã¯ã„ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åï¼ˆ/ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼‰ | `/app/config/key` |
| value | ã¯ã„ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€¤ | `ä»»æ„ã®æ–‡å­—åˆ—` |
| type | ã„ã„ãˆ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: Stringï¼‰ | `String`, `SecureString` |
| description | ã„ã„ãˆ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¬æ˜ | `ä»»æ„ã®æ–‡å­—åˆ—` |

**ä¾‹:**
```csv
name,value,type,description
/app/database/host,localhost,String,ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ›ã‚¹ãƒˆ
/app/database/password,secret123,SecureString,ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
/app/api/key,abc-123-def,SecureString,å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ç”¨APIã‚­ãƒ¼
```

### ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆCSV

| åˆ—å | å¿…é ˆ | èª¬æ˜ | ä¾‹ |
|------|------|------|-----|
| name | ã¯ã„ | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå | `prod/database/credentials` |
| value | ã¯ã„ | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå€¤ï¼ˆJSONå¯ï¼‰ | `{"user":"admin","pass":"secret"}` |
| description | ã„ã„ãˆ | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®èª¬æ˜ | `ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èªè¨¼æƒ…å ±` |

**ä¾‹:**
```csv
name,value,description
prod/database/credentials,"{""username"":""admin"",""password"":""secret""}",ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èªè¨¼æƒ…å ±
prod/api/tokens,"{""token"":""abc123"",""refresh"":""def456""}",APIãƒˆãƒ¼ã‚¯ãƒ³
prod/ssl/certificate,-----BEGIN CERTIFICATE-----...,SSLè¨¼æ˜æ›¸
```

## AWSè¨­å®š

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯AWS SDKã‚’ä½¿ç”¨ã—ã€æ¨™æº–çš„ãªAWSè¨­å®šã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

1. **AWSèªè¨¼æƒ…å ±**: AWS CLIã€ç’°å¢ƒå¤‰æ•°ã€ã¾ãŸã¯IAMãƒ­ãƒ¼ãƒ«ã§è¨­å®š
2. **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: `--region`ãƒ•ãƒ©ã‚°ã¾ãŸã¯AWS_REGIONç’°å¢ƒå¤‰æ•°ã§æŒ‡å®š
3. **ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«**: `--profile`ãƒ•ãƒ©ã‚°ã¾ãŸã¯AWS_PROFILEç’°å¢ƒå¤‰æ•°ã§æŒ‡å®š

### å¿…è¦ãªAWSæ¨©é™

#### Parameter Storeç”¨:
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ssm:GetParameter",
        "ssm:PutParameter"
      ],
      "Resource": "*"
    }
  ]
}
```

#### Secrets Managerç”¨:
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "secretsmanager:GetSecretValue",
        "secretsmanager:CreateSecret",
        "secretsmanager:UpdateSecret"
      ],
      "Resource": "*"
    }
  ]
}
```

## ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”Ÿæˆ:
   ```bash
   aps generate-template
   ```

2. ç”Ÿæˆã•ã‚ŒãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿/ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç·¨é›†

3. ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ã§å¤‰æ›´ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:
   ```bash
   aps sync-parameters --file ./templates/parameters-template.csv --dry-run
   ```

4. å¤‰æ›´ã‚’é©ç”¨:
   ```bash
   aps sync-parameters --file ./templates/parameters-template.csv
   ```

### ãƒãƒ«ãƒç’°å¢ƒè¨­å®š

```bash
# é–‹ç™ºç’°å¢ƒ
aps sync-parameters --file dev-params.csv --profile dev --region us-east-1

# æœ¬ç•ªç’°å¢ƒ
aps sync-secrets --file prod-secrets.csv --profile prod --region us-west-2
```

## å‡ºåŠ›ä¾‹

### æˆåŠŸæ™‚ã®å‡ºåŠ›
```
â„¹ 2025-01-14T10:30:00.000Z parameters.csvã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒæœŸã‚’é–‹å§‹
â„¹ 2025-01-14T10:30:00.100Z 3å€‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ

â–¼ AWS Parameter Storeã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åŒæœŸä¸­
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ 2025-01-14T10:30:00.200Z ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½œæˆ: /app/database/host
â†» 2025-01-14T10:30:00.300Z ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°: /app/database/password
âŠ 2025-01-14T10:30:00.400Z ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå¤‰æ›´ãªã—ï¼‰: /app/api/key

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š æ¦‚è¦:
  âœ“ æˆåŠŸ: 1
  âœ— å¤±æ•—: 0
  â†» æ›´æ–°: 1
  âŠ ã‚¹ã‚­ãƒƒãƒ—: 1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ 2025-01-14T10:30:00.500Z ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒæœŸãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ
```

### ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³å‡ºåŠ›
```
âš  2025-01-14T10:30:00.000Z ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰ - å¤‰æ›´ã¯è¡Œã‚ã‚Œã¾ã›ã‚“
âš¡ 2025-01-14T10:30:00.200Z [ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³] ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½œæˆäºˆå®š: /app/new/config
âš¡ 2025-01-14T10:30:00.300Z [ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³] ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°äºˆå®š: /app/existing/config
```

## é–‹ç™º

### ãƒ“ãƒ«ãƒ‰

```bash
npm run build
```

### ãƒ†ã‚¹ãƒˆ

```bash
npm test
```

### ãƒªãƒ³ãƒˆ

```bash
npm run lint
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT - è©³ç´°ã¯[LICENSE](LICENSE)ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## è²¢çŒ®

1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯
2. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
3. å¤‰æ›´ã‚’å®Ÿè£…
4. è©²å½“ã™ã‚‹å ´åˆã¯ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
5. `npm run lint`ã¨`npm test`ã‚’å®Ÿè¡Œ
6. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æå‡º

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **æ¨©é™æ‹’å¦**: AWSèªè¨¼æƒ…å ±ã«å¿…è¦ãªæ¨©é™ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
2. **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„**: `--region`ã§æ­£ã—ã„AWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
3. **CSVè§£æã‚¨ãƒ©ãƒ¼**: CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæœŸå¾…ã•ã‚Œã‚‹åˆ—ã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
4. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åãŒç„¡åŠ¹**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã¯`/`ã§å§‹ã¾ã‚Šã€æœ‰åŠ¹ãªæ–‡å­—ã®ã¿å«ã‚€å¿…è¦ãŒã‚ã‚‹

### ãƒ˜ãƒ«ãƒ—ã®å–å¾—

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:

1. è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã«ã¤ã„ã¦ã¯AWS CloudTrailãƒ­ã‚°ã‚’ç¢ºèª
2. CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæœŸå¾…ã•ã‚Œã‚‹æ§‹é€ ã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
3. AWSèªè¨¼æƒ…å ±ã¨æ¨©é™ã‚’ç¢ºèª
4. å¤‰æ›´ã‚’é©ç”¨ã™ã‚‹å‰ã«`--dry-run`ã‚’ä½¿ç”¨ã—ã¦å¤‰æ›´ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼